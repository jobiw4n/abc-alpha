<!DOCTYPE html>
<!-- saved from url=(0036)http://127.0.0.1:5500/draggable.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ABC Alpha</title>
    <link rel="stylesheet" href="./ABC Alpha_files/jquery-ui.css">
    <link rel="stylesheet" href="./ABC Alpha_files/style.css">
    <script src="./ABC Alpha_files/jquery-3.7.1.js"></script>
    <script src="./ABC Alpha_files/jquery-ui.js"></script>
  
    
    <script src="./ABC Alpha_files/words.js"></script>
    <script src="./ABC Alpha_files/jquery.ui.touch-punch.js"></script>
    <!-- <script src="./jquery.draggableTouch.js"></script> -->
 
    <script>
 String.prototype.shuffle = function () {
    var a = this.split(""),
        n = a.length;

    for(var i = n - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var tmp = a[i];
        a[i] = a[j];
        a[j] = tmp;
    }
    return a.join("");
}

//-> "veolrm  hth  ke opynug tusbxq ocrad ofeizwj"

    $( function(){
        generateWord()
    })

    function newWord(word){
        var word = '' || word
        $("#droppable-word")[0].innerHTML=''
        $('#draggable-word')[0].innerHTML=''
        generateWord(word)
    }
    var currentWord
    var correctCount = 0

    function getWord(){
        var j = Math.floor(Math.random() * (words.length))
        return words[j]
    }
        function generateWord(word) {
        $('#completed')[0].style.display = 'none'
        //generate word
        var newWord = word || getWord() // getWord()
        currentWord = newWord
        correctCount = 0
        var shuffledWord = newWord.shuffle()
        // console.log('word is: '+newWord+' '+newWord[3])
        var setPoints = []
        for(var i=0;i<newWord.length;i++){
            var droppableTemplate = `<div class="ui-widget-header droppable">
        <p>${newWord[i]}</p>
      </div>`
            var draggableTemplate = `  <div id="${shuffledWord[i]}-${i}" class="ui-widget-content draggable"><p>${shuffledWord[i]}</p></div>`
            
            $("#droppable-word").append(droppableTemplate)
            $('#draggable-word').append(draggableTemplate)
            

            // document.getElementById("droppableWord").appendChild(droppableTemplate)

        }
        // var gapNum = shuffledWord.length
        // console.log(gapNum+'gap')
        // $('#draggable-word')[0].style.gap = gapNum+'em'

        for(var i=0;i<shuffledWord.length;i++){
            var d = $(`#${shuffledWord[i]}-${i}`)[0]
            setPoints.push(d.getBoundingClientRect())
        }

        // console.log(setPoints)

        for(var i=0;i<shuffledWord.length;i++){
            var d = $(`#${shuffledWord[i]}-${i}`)[0]
            var coords = setPoints[i]
            // console.log(coords)
                d.style.position = "absolute";
                d.style.left = coords.left+'px';
                d.style.top = coords.top+'px';
                d.style.margin = 0
        }


        // function getWord(newWord){ // add randomized list
        //     if(newWord){
        //         return word
        //     } else {
        //         return 'apple'
        //     }
        // }

      $( ".draggable" ).draggable({
            revert: function(){
                if ($(this).hasClass('drag-revert')) {
                $(this).removeClass('drag-revert');
                return true;
            }}
        });
    //     $(".draggable")
    // .draggableTouch({
    //         revert: function(){
    //             if ($(this).hasClass('drag-revert')) {
    //             $(this).removeClass('drag-revert');
    //             return true;
    //         }}
    //     }

    // )
    // .bind("dragstart", function(event, pos) {
    //     console.log("drag started on:", this, "at position:", pos);
    // })
    // .bind("dragend", function(event, pos) {
    //     console.log("drag ended on:", this, "at position:", pos);
    // });

      $( ".droppable" ).droppable({
        drop: function( event, ui ) {

            
            //get letter of draggable and droppable
            var droppableLetter = $(this).find("p").html()
            var draggableLetter = ui.draggable.find('p').html()
            // console.log(droppableLetter)
            // console.log(draggableLetter)
            if(droppableLetter==draggableLetter && !($(this).hasClass('filled'))){
                //match
              
                $( this )
                    .addClass( "ui-state-highlight" )
                    .addClass('filled')
            
                    ui.draggable.addClass("ui-state-highlight")
                    //tween draggable to final location
                // this.droppable
    // move to parent
    
      
      var rect1 = ui.draggable[0].getBoundingClientRect();
      var rect2 = this.getBoundingClientRect();
      
      var x = (rect2.left - rect1.left);
      var y = (rect2.top - rect1.top);
    //   ui.draggable[0].top = 0
    
    // console.log(x+" "+y)
    // $(this).droppable( "option", "accept",null )

    var d = ui.draggable[0];

        d.style.position = "absolute";
        d.style.left = rect2.left+'px';
        d.style.top = rect2.top+'px';
        d.style.margin = 0
             
    
    ui.draggable.draggable("disable")
    correctCount++
    if(correctCount == currentWord.length){
        $('#completed')[0].style.display = 'block'
        console.log('completed!')
    }
    
            } else {
                console.log('missed')
                //no match
                // add 'find new location near dropped point' functionality
                ui.draggable.addClass('drag-revert')
             
            }
         
        }
        
      });

    //   $('#droppable').droppableTouch()
    } ;
    </script>
  </head>
  <body style="cursor: pointer;">

    <button onclick="newWord()">New Word</button> <button onclick="newWord(currentWord)">Reset</button>
    <div id="completed" style="display: none;"><h1>Yay!</h1></div>
    <div id="droppable-container">
        <div id="droppable-word">

        <div class="ui-widget-header droppable ui-droppable ui-state-highlight filled">
        <p>p</p>
      </div><div class="ui-widget-header droppable ui-droppable">
        <p>a</p>
      </div><div class="ui-widget-header droppable ui-droppable">
        <p>r</p>
      </div><div class="ui-widget-header droppable ui-droppable ui-state-highlight filled">
        <p>t</p>
      </div><div class="ui-widget-header droppable ui-droppable">
        <p>y</p>
      </div></div>
    </div>
    <div id="draggable-container">
        <div id="draggable-word">

          <div id="a-0" class="ui-widget-content draggable ui-draggable ui-draggable-handle" style="position: absolute; left: 30.7344px; top: 482.148px; margin: 0px;"><p>a</p></div>  <div id="t-1" class="ui-widget-content draggable ui-draggable ui-draggable-handle ui-state-highlight ui-draggable-disabled" style="position: absolute; left: 470.242px; top: 344px; margin: 0px;"><p>t</p></div>  <div id="y-2" class="ui-widget-content draggable ui-draggable ui-draggable-handle" style="position: absolute; left: 361.906px; top: 482.148px; margin: 0px;"><p>y</p></div>  <div id="p-3" class="ui-widget-content draggable ui-draggable ui-draggable-handle ui-state-highlight ui-draggable-disabled" style="position: absolute; left: 150.734px; top: 344px; margin: 0px;"><p>p</p></div>  <div id="r-4" class="ui-widget-content draggable ui-draggable ui-draggable-handle" style="position: absolute; left: 685.594px; top: 482.148px; margin: 0px;"><p>r</p></div></div>
    </div>


   

   
   
   
   
  <!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body></html>